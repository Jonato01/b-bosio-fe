<div class="manage-container">
  <div class="header">
    <h2>
      <mat-icon>home_work</mat-icon>
      Gestione Alloggi
    </h2>
  </div>

  <div class="content-grid">
    <!-- Form Section -->
    <mat-card class="form-card">
      <mat-card-header>
        <mat-card-title>
          @if (editingId()) {
            <mat-icon>edit</mat-icon>
            Modifica Alloggio
          } @else {
            <mat-icon>add</mat-icon>
            Nuovo Alloggio
          }
        </mat-card-title>
      </mat-card-header>

      <mat-card-content>
        <form [formGroup]="accommodationForm" (ngSubmit)="onSubmit()">
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Slug (URL)</mat-label>
            <input matInput formControlName="slug" placeholder="villa-mare">
            <mat-icon matPrefix>link</mat-icon>
            <mat-hint>Solo lettere minuscole, numeri e trattini</mat-hint>
            @if (accommodationForm.get('slug')?.invalid && accommodationForm.get('slug')?.touched) {
              <mat-error>
                @if (accommodationForm.get('slug')?.errors?.['required']) {
                  Slug richiesto
                } @else if (accommodationForm.get('slug')?.errors?.['pattern']) {
                  Solo lettere minuscole, numeri e trattini
                }
              </mat-error>
            }
          </mat-form-field>

          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Titolo</mat-label>
            <input matInput formControlName="title" placeholder="Villa al Mare">
            <mat-icon matPrefix>title</mat-icon>
            @if (accommodationForm.get('title')?.invalid && accommodationForm.get('title')?.touched) {
              <mat-error>Titolo richiesto</mat-error>
            }
          </mat-form-field>

          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Descrizione</mat-label>
            <textarea matInput formControlName="description" rows="4"
                      placeholder="Descrizione dell'alloggio..."></textarea>
            <mat-icon matPrefix>description</mat-icon>
            @if (accommodationForm.get('description')?.invalid && accommodationForm.get('description')?.touched) {
              <mat-error>Descrizione richiesta</mat-error>
            }
          </mat-form-field>

          <div class="form-actions">
            @if (editingId()) {
              <button mat-button type="button" (click)="resetForm()">
                <mat-icon>cancel</mat-icon>
                Annulla
              </button>
            }
            <button mat-raised-button color="primary" type="submit"
                    [disabled]="accommodationForm.invalid || loading()">
              @if (loading()) {
                <mat-spinner diameter="20"></mat-spinner>
              } @else {
                <ng-container>
                  <mat-icon>{{ editingId() ? 'save' : 'add' }}</mat-icon>
                  {{ editingId() ? 'Aggiorna' : 'Crea' }} Alloggio
                </ng-container>
              }
            </button>
          </div>
        </form>
      </mat-card-content>
    </mat-card>

    <!-- List Section -->
    <mat-card class="list-card">
      <mat-card-header>
        <mat-card-title>
          <mat-icon>list</mat-icon>
          Alloggi Esistenti ({{ accommodations().length }})
        </mat-card-title>
      </mat-card-header>

      <mat-card-content>
        @if (loading() && accommodations().length === 0) {
          <div class="loading-container">
            <mat-spinner></mat-spinner>
          </div>
        } @else if (accommodations().length === 0) {
          <div class="empty-state">
            <mat-icon>home_work</mat-icon>
            <p>Nessun alloggio presente</p>
          </div>
        } @else {
          <mat-list>
            @for (accommodation of accommodations(); track accommodation.id) {
              <mat-list-item>
                <div class="accommodation-item">
                  <div class="accommodation-info">
                    <h3>{{ accommodation.title }}</h3>
                    <p class="slug">{{ accommodation.slug }}</p>
                    <p class="description">{{ accommodation.description }}</p>
                  </div>
                  <div class="accommodation-actions">
                    <button mat-icon-button color="primary"
                            (click)="editAccommodation(accommodation)"
                            matTooltip="Modifica">
                      <mat-icon>edit</mat-icon>
                    </button>
                    <button mat-icon-button color="warn"
                            (click)="deleteAccommodation(accommodation)"
                            matTooltip="Elimina">
                      <mat-icon>delete</mat-icon>
                    </button>
                  </div>
                </div>
              </mat-list-item>
              @if (!$last) {
                <mat-divider></mat-divider>
              }
            }
          </mat-list>
        }
      </mat-card-content>
    </mat-card>
  </div>
</div>

